<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dev.alleon.mappers.UserMapper" >
    <insert id="insert"
    useGeneratedKeys="true"
    keyColumn="index"
    keyProperty="index">
        INSERT INTO `aeo`.`users` (name, profile, email, password, contact_mvno_code, contact_first, contact_second, contact_third, nickname, birth, gender, provider_key, provider_type, address_postal, address_primary, address_secondary, active_state, created_at, term_agreed_at, modified_at, last_login, life_cycle_code, household_type_code, interest_sub_code) VALUES (#{user.name}, #{user.profile}, #{user.email}, #{user.password}, #{user.contactMvnoCode}, #{user.contactFirst}, #{user.contactSecond}, #{user.contactThird}, #{user.nickname}, #{user.birth}, #{user.gender}, #{user.providerKey}, #{user.providerType}, #{user.addressPostal}, #{user.addressPrimary}, #{user.addressSecondary}, #{user.activeState}, #{user.createdAt}, #{user.termAgreedAt}, #{user.modifiedAt}, #{user.lastLogin}, #{user.lifeCycleCode}, #{user.householdTypeCode}, #{user.interestSubCode})
    </insert>
    <update id="update">
        UPDATE `aeo`.`users`
        SET
            name = #{user.name},
            profile = #{user.profile},
            email = #{user.email},
            password = #{user.password},
            contact_mvno_code = #{user.contactMvnoCode},
            contact_first = #{user.contactFirst},
            contact_second = #{user.contactSecond},
            contact_third = #{user.contactThird},
            nickname = #{user.nickname},
            birth = #{user.birth},
            gender = #{user.gender},
            provider_key = #{user.providerKey},
            provider_type = #{user.providerType},
            address_postal = #{user.addressPostal},
            address_primary = #{user.addressPrimary},
            address_secondary = #{user.addressSecondary},
            active_state = #{user.activeState},
            created_at = #{user.createdAt},
            term_agreed_at = #{user.termAgreedAt},
            modified_at = #{user.modifiedAt},
            last_login = #{user.lastLogin},
            life_cycle_code = #{user.lifeCycleCode},
            household_type_code = #{user.householdTypeCode},
            interest_sub_code = #{user.interestSubCode}
        WHERE `index` = #{user.index}
        LIMIT 1
    </update>
    <update id="updateProfile">
        UPDATE `aeo`.`users`
        SET `profile` = #{profile, jdbcType=BLOB},
            `modified_at` = NOW()
        WHERE `index` = #{index}
        LIMIT 1
    </update>
    <select id="selectLocalUserByContact" resultType="com.dev.alleon.entities.UserEntity">
        SELECT `index`               AS `id`,
               `name`                AS `name`,
               `profile`             AS `profile`,
               `email`               AS `email`,
               `password`            AS `password`,
               contact_mvno_code     AS `contactMvnoCode`,
               `contact_first`       AS `contactFirst`,
               `contact_second`      AS `contactSecond`,
               `contact_third`       AS `contactThird`,
               `nickname`            AS `nickname`,
               `birth`               AS `birth`,
               `gender`              AS `gender`,
               `provider_key`        AS `providerKey`,
               `provider_type`       AS `providerType`,
               `address_postal`      AS `addressPostal`,
               `address_primary`     AS `addressPrimary`,
               `address_secondary`   AS `addressSecondary`,
               `active_state`        AS `activeState`,
               `created_at`          AS `createdAt`,
               `term_agreed_at` AS `termAgreedAt`,
               `modified_at`         AS `modifiedAt`,
               `last_login`          AS `lastLogin`,
               `life_cycle_code`     AS `lifeCycleCode`,
               `household_type_code` AS `householdTypeCode`,
               `interest_sub_code`   AS `interestSubCode`
        FROM `aeo`.`users`
        WHERE `contact_first` = #{contactFirst}
          AND `contact_second` = #{contactSecond}
          AND `contact_third` = #{contactThird}
          AND `provider_type` = 'local'
        LIMIT 1
    </select>
    <select id="selectCountByEmail" resultType="java.lang.Integer">
        SELECT COUNT(0)
        FROM `aeo`.`users`
        WHERE `email` = #{email}
    </select>
    <select id="selectCountByNickname" resultType="java.lang.Integer">
        SELECT COUNT(0)
        FROM `aeo`.`users`
        WHERE `nickname` = #{nickname}
    </select>
    <select id="selectCountByContact" resultType="java.lang.Integer">
        SELECT COUNT(0)
        FROM `aeo`.`users`
        WHERE `contact_first` = #{contactFirst}
        AND `contact_second` = #{contactSecond}
        AND `contact_third` = #{contactThird}
    </select>
    <select id="selectUserCountByEmail" resultType="java.lang.Integer">
        SELECT COUNT(0)
        FROM `aeo`.`users`
        WHERE `email` = #{email}
    </select>
    <select id="selectUserByEmail" resultType="com.dev.alleon.entities.UserEntity">
        SELECT `index`               AS `id`,
               `name`                AS `name`,
               `profile`             AS `profile`,
               `email`               AS `email`,
               `password`            AS `password`,
               contact_mvno_code     AS `contactMvnoCode`,
               `contact_first`       AS `contactFirst`,
               `contact_second`      AS `contactSecond`,
               `contact_third`       AS `contactThird`,
               `nickname`            AS `nickname`,
               `birth`               AS `birth`,
               `gender`              AS `gender`,
               `provider_key`        AS `providerKey`,
               `provider_type`       AS `providerType`,
               `address_postal`      AS `addressPostal`,
               `address_primary`     AS `addressPrimary`,
               `address_secondary`   AS `addressSecondary`,
               `active_state`        AS `activeState`,
               `created_at`          AS `createdAt`,
               `term_agreed_at` AS `termAgreedAt`,
               `modified_at`         AS `modifiedAt`,
               `last_login`          AS `lastLogin`,
               `life_cycle_code`     AS `lifeCycleCode`,
               `household_type_code` AS `householdTypeCode`,
               `interest_sub_code`   AS `interestSubCode`
        FROM `aeo`.`users`
        WHERE `email` = #{email}
        LIMIT 1
    </select>
    <select id="selectUserByProviderKey" resultType="com.dev.alleon.entities.UserEntity">
        SELECT `index`               AS `id`,
               `name`                AS `name`,
               `profile`             AS `profile`,
               `email`               AS `email`,
               `password`            AS `password`,
               contact_mvno_code     AS `contactMvnoCode`,
               `contact_first`       AS `contactFirst`,
               `contact_second`      AS `contactSecond`,
               `contact_third`       AS `contactThird`,
               `nickname`            AS `nickname`,
               `birth`               AS `birth`,
               `gender`              AS `gender`,
               `provider_key`        AS `providerKey`,
               `provider_type`       AS `providerType`,
               `address_postal`      AS `addressPostal`,
               `address_primary`     AS `addressPrimary`,
               `address_secondary`   AS `addressSecondary`,
               `active_state`        AS `activeState`,
               `created_at`          AS `createdAt`,
               `term_agreed_at` AS `termAgreedAt`,
               `modified_at`         AS `modifiedAt`,
               `last_login`          AS `lastLogin`,
               `life_cycle_code`     AS `lifeCycleCode`,
               `household_type_code` AS `householdTypeCode`,
               `interest_sub_code`   AS `interestSubCode`
        FROM `aeo`.`users`
        WHERE `provider_type` = #{providerType}
        AND `provider_key` = #{providerKey}
        LIMIT 1
    </select>
    <select id="selectUserByProviderTypeAndProviderKey" resultType="com.dev.alleon.entities.UserEntity">
        SELECT `index`               AS `id`,
               `name`                AS `name`,
               `profile`             AS `profile`,
               `email`               AS `email`,
               `password`            AS `password`,
               contact_mvno_code     AS `contactMvnoCode`,
               `contact_first`       AS `contactFirst`,
               `contact_second`      AS `contactSecond`,
               `contact_third`       AS `contactThird`,
               `nickname`            AS `nickname`,
               `birth`               AS `birth`,
               `gender`              AS `gender`,
               `provider_key`        AS `providerKey`,
               `provider_type`       AS `providerType`,
               `address_postal`      AS `addressPostal`,
               `address_primary`     AS `addressPrimary`,
               `address_secondary`   AS `addressSecondary`,
               `active_state`        AS `activeState`,
               `created_at`          AS `createdAt`,
               `term_agreed_at` AS `termAgreedAt`,
               `modified_at`         AS `modifiedAt`,
               `last_login`          AS `lastLogin`,
               `life_cycle_code`     AS `lifeCycleCode`,
               `household_type_code` AS `householdTypeCode`,
               `interest_sub_code`   AS `interestSubCode`
        FROM `aeo`.`users`
        WHERE `provider_type` = #{providerType} AND `provider_key`=#{providerKey};
    </select>
</mapper>